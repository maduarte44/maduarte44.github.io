<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Trail 44K">
<meta name="theme-color" content="#080808">
<link rel="manifest" id="manifest-link">
<title>Trail 44K ‚õ∞</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
:root {
  --bg:#080808; --bg2:#0d0d0d; --bg3:#111; --border:#1e1e22; --text:#ccc; --sub:#4a4a5a;
  /* SUAVE  ‚Üí verde  ‚Üí #ffa477 salmon pastel */
  --c-suave-bg:#1f0f08;   --c-suave-bd:#7a4030;   --c-suave-tx:#ffa477;  --c-suave-ch:#2a1208;  --c-suave-gl:rgba(255,164,119,.45);
  /* MEDIO  ‚Üí amarillo ‚Üí #ffbb77 */
  --c-medio-bg:#1f1408;   --c-medio-bd:#7a5020;   --c-medio-tx:#ffbb77;  --c-medio-ch:#2a1a08;  --c-medio-gl:rgba(255,187,119,.45);
  /* INTENSO ‚Üí rojo   ‚Üí #ac6d77 */
  --c-intenso-bg:#170a0d; --c-intenso-bd:#5a2a35; --c-intenso-tx:#ac6d77;--c-intenso-ch:#200810;--c-intenso-gl:rgba(172,109,119,.45);
  /* FUERZA  ‚Üí azul   ‚Üí #bb85c4 lavender */
  --c-fuerza-bg:#130a18;  --c-fuerza-bd:#4a2a60;  --c-fuerza-tx:#bb85c4; --c-fuerza-ch:#1c0a25; --c-fuerza-gl:rgba(187,133,196,.45);
  /* DESCANSO ‚Üí neutral dark pastel */
  --c-descanso-bg:#0e0e12;--c-descanso-bd:#252530;--c-descanso-tx:#4a4a5a;--c-descanso-ch:#141420;--c-descanso-gl:transparent;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--text);font-family:'Barlow Condensed',sans-serif;min-height:100vh;min-height:100dvh;overflow-x:hidden;padding-bottom:calc(72px + env(safe-area-inset-bottom,0px))}
/* HEADER */
#hdr{background:var(--bg2);border-bottom:1px solid var(--border);padding:0 16px;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:20}
.logo{font-size:20px;font-weight:900;letter-spacing:2px;color:#fff;outline:none;cursor:text;border-bottom:1px dashed transparent;transition:border-color .2s;min-width:60px}.logo:focus{border-bottom-color:#ffbb7766}.logo:hover:not(:focus){border-bottom-color:#333}
.logo-sub{font-size:9px;color:var(--sub);font-family:'JetBrains Mono',monospace;letter-spacing:1px}
#race-countdown{font-family:'JetBrains Mono',monospace;font-size:11px;text-align:right}
.cd-num{font-size:22px;font-weight:700;line-height:1}
/* TABBAR */
#tabbar{position:fixed;bottom:0;left:0;right:0;background:var(--bg2);border-top:1px solid var(--border);display:flex;z-index:20;padding-bottom:env(safe-area-inset-bottom,0px)}
.tab-btn{flex:1;padding:10px;background:none;border:none;color:var(--sub);font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;letter-spacing:1.5px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;transition:color .15s}
.tab-btn.active{color:#fff}
.tab-btn.active .tab-icon{transform:scale(1.1)}
.tab-icon{font-size:18px;line-height:1;transition:transform .15s}
/* WEEK NAV */
#week-nav{display:flex;align-items:center;padding:14px 14px 8px;gap:10px}
.nav-btn{width:38px;height:38px;background:var(--bg3);border:1px solid #222;color:#888;border-radius:10px;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .1s;user-select:none;-webkit-user-select:none}
.nav-btn:active{background:#1a1a1a;transform:scale(.93)}
#week-info{flex:1;text-align:center}
#week-num{font-size:26px;font-weight:900;color:#fff;letter-spacing:2px;line-height:1}
#week-dates{font-size:11px;color:var(--sub);font-family:'JetBrains Mono',monospace;margin-top:2px}
#phase-badge{display:inline-block;margin-top:4px;padding:2px 10px;border-radius:12px;font-size:11px;font-weight:700;letter-spacing:1px}
#week-km{font-size:11px;color:#444;font-family:'JetBrains Mono',monospace;margin-top:2px}
/* SWAP BANNER */
#swap-banner{display:none;background:#ffbb7718;border-top:1px solid #ffbb7733;border-bottom:1px solid #ffbb7733;padding:8px 16px;font-size:12px;font-weight:700;color:#ffbb77;letter-spacing:1px;text-align:center}
#swap-banner.show{display:block}
/* LEGEND */
#legend{display:flex;gap:10px;justify-content:center;padding:0 12px 8px;flex-wrap:wrap}
.lg-item{display:flex;align-items:center;gap:4px;font-size:10px;font-weight:700;letter-spacing:.5px}
.lg-dot{width:8px;height:8px;border-radius:2px;flex-shrink:0}
/* CARDS - VERTICAL */
#cards-wrap{padding:0 12px 12px}
#cards-grid{display:flex;flex-direction:column;gap:8px}
.day-card{width:100%;border-radius:14px;padding:12px 14px 10px;display:flex;flex-direction:row;align-items:center;gap:12px;cursor:pointer;transition:transform .12s,box-shadow .15s,opacity .15s,border-color .15s;position:relative;border:1.5px solid;user-select:none;-webkit-user-select:none}
.day-card:active{transform:scale(.988)}
.card-left{flex:1;min-width:0}
.card-right{display:flex;flex-direction:column;align-items:flex-end;gap:5px;flex-shrink:0}
.swap-badge{position:absolute;top:9px;left:9px;background:#ffbb77;color:#1a0a00;font-size:9px;font-weight:900;padding:2px 6px;border-radius:6px;letter-spacing:.5px;display:none}
.day-card.selected .swap-badge{display:block}
.day-card.swap-target{opacity:.55;border-style:dashed}
.card-day{font-size:10px;color:var(--sub);font-family:'JetBrains Mono',monospace;letter-spacing:.5px;margin-bottom:3px;display:flex;align-items:center;gap:3px}
.today-dot{width:5px;height:5px;border-radius:50%;background:#ffbb77;flex-shrink:0}
.card-session{font-size:14px;font-weight:700;line-height:1.25;margin-bottom:3px}
.card-chip{display:inline-block;padding:2px 7px;border-radius:7px;font-size:9px;font-weight:700;letter-spacing:.5px}
.card-km{font-family:'JetBrains Mono',monospace;font-size:17px;font-weight:700;line-height:1}
.card-km span{font-size:9px;opacity:.7}
.card-logged{font-size:9px;color:#ffa477;font-family:'JetBrains Mono',monospace}
.card-reacts{display:flex;gap:3px;margin-top:4px}
.rxn-btn{font-size:17px;background:none;border:none;cursor:pointer;padding:2px 3px;border-radius:6px;transition:all .15s;line-height:1}
.rxn-btn.active{background:rgba(255,255,255,.12)}
.rxn-btn.inactive{filter:grayscale(1);opacity:0.28}
.log-dot{position:absolute;top:10px;right:10px;width:6px;height:6px;border-radius:50%;background:#ffa477}
/* Type styles */
.tc-SUAVE   {background:var(--c-suave-bg);  border-color:var(--c-suave-bd)}
.tc-SUAVE    .card-session,.tc-SUAVE    .card-km{color:var(--c-suave-tx)}
.tc-SUAVE    .card-chip{background:var(--c-suave-ch); color:var(--c-suave-tx)}
.tc-MEDIO   {background:var(--c-medio-bg);  border-color:var(--c-medio-bd)}
.tc-MEDIO    .card-session,.tc-MEDIO    .card-km{color:var(--c-medio-tx)}
.tc-MEDIO    .card-chip{background:var(--c-medio-ch); color:var(--c-medio-tx)}
.tc-INTENSO {background:var(--c-intenso-bg);border-color:var(--c-intenso-bd)}
.tc-INTENSO  .card-session,.tc-INTENSO  .card-km{color:var(--c-intenso-tx)}
.tc-INTENSO  .card-chip{background:var(--c-intenso-ch);color:var(--c-intenso-tx)}
.tc-FUERZA  {background:var(--c-fuerza-bg); border-color:var(--c-fuerza-bd)}
.tc-FUERZA   .card-session,.tc-FUERZA   .card-km{color:var(--c-fuerza-tx)}
.tc-FUERZA   .card-chip{background:var(--c-fuerza-ch); color:var(--c-fuerza-tx)}
.tc-DESCANSO{background:var(--c-descanso-bg);border-color:var(--c-descanso-bd)}
.tc-DESCANSO .card-session{color:var(--c-descanso-tx)}
.tc-DESCANSO .card-chip{background:var(--c-descanso-ch);color:var(--c-descanso-tx)}
/* Hint */
.drag-hint{text-align:center;font-size:10px;color:#1e1e1e;letter-spacing:1px;padding:2px 0 6px}
/* MODAL */
#modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:100;display:none;align-items:flex-end}
#modal-overlay.open{display:flex}
#modal{background:#0f0f0f;border-radius:20px 20px 0 0;border-top:1px solid var(--border);width:100%;max-height:92vh;overflow-y:auto;padding:20px 18px calc(20px + env(safe-area-inset-bottom,0px));animation:slideUp .22s ease}
@keyframes slideUp{from{transform:translateY(40px);opacity:0}to{transform:translateY(0);opacity:1}}
.m-handle{width:36px;height:4px;background:#222;border-radius:2px;margin:0 auto 18px}
.m-day{font-size:11px;color:var(--sub);font-family:'JetBrains Mono',monospace;margin-bottom:4px}
#m-title{font-size:24px;font-weight:900;letter-spacing:.5px;margin-bottom:8px}
#m-chips{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
.m-chip{padding:3px 10px;border-radius:8px;font-size:11px;font-weight:700;letter-spacing:.5px}
.m-km{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700}
#m-desc{font-size:14px;color:#888;line-height:1.65;padding:11px 12px;background:#111;border-radius:10px;border-left:3px solid #222;margin-bottom:14px}
.m-sec{font-size:10px;font-weight:700;color:#444;letter-spacing:2px;text-transform:uppercase;margin-bottom:9px}
.m-time-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:10px}
.m-dist-row{margin-bottom:10px}
.m-lbl{font-size:10px;color:var(--sub);font-family:'JetBrains Mono',monospace;margin-bottom:4px;letter-spacing:.5px}
.m-lbl-sub{font-size:9px;color:#333;font-family:'JetBrains Mono',monospace;margin-bottom:4px;text-align:center}
.m-input{width:100%;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;color:#e8e8f0;padding:10px 8px;font-size:20px;font-family:'JetBrains Mono',monospace;outline:none;transition:border .15s;text-align:center}
.m-input:focus{border-color:#444}
.m-input-dist{width:100%;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;color:#e8e8f0;padding:10px 12px;font-size:20px;font-family:'JetBrains Mono',monospace;outline:none;transition:border .15s}
.m-input-dist:focus{border-color:#444}
.m-pace{text-align:center;padding:8px 0 12px;font-family:'JetBrains Mono',monospace;font-size:13px;color:#4a4a5a;min-height:28px;letter-spacing:.5px;transition:color .2s}
.m-pace.has-pace{color:#ffa477}
.m-rxn-row{display:flex;gap:10px;align-items:center;margin-bottom:14px}
.m-rxn-lbl{font-size:10px;color:#444;letter-spacing:1.5px;text-transform:uppercase}
.m-rxn-btn{font-size:28px;background:none;border:2px solid transparent;cursor:pointer;padding:4px 8px;border-radius:10px;transition:all .15s;line-height:1}
.m-rxn-btn.active{border-color:rgba(255,255,255,.25);background:rgba(255,255,255,.07)}
.m-rxn-btn.inactive{filter:grayscale(1);opacity:0.25}
#m-save{width:100%;padding:13px;border-radius:12px;border:none;color:#fff;font-size:15px;font-weight:700;letter-spacing:1.5px;font-family:'Barlow Condensed',sans-serif;cursor:pointer;transition:opacity .15s,transform .1s}
#m-save:active{transform:scale(.98);opacity:.8}
#m-saved{text-align:center;color:#ffa477;font-size:14px;font-weight:700;letter-spacing:2px;padding:10px 0;display:none}
#m-gpx{text-align:center;font-size:10px;color:#222;font-family:'JetBrains Mono',monospace;margin-top:8px}
/* ANALYTICS */
#tab-stats{padding:14px 14px 0}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.stat-card{background:var(--bg2);border-radius:12px;padding:14px;text-align:center;border:1px solid var(--border)}
.stat-val{font-size:24px;font-weight:900;font-family:'JetBrains Mono',monospace;line-height:1}
.stat-lbl{font-size:9px;color:#444;letter-spacing:1.5px;text-transform:uppercase;margin-top:4px}
.chart-card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:14px}
.chart-ttl{font-size:10px;font-weight:700;color:var(--sub);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px}
.rxn-sum{display:flex;gap:18px;align-items:center}
.rxn-st{text-align:center}
.rxn-em{font-size:28px}
.rxn-ct{font-size:20px;font-weight:900;font-family:'JetBrains Mono',monospace;color:#fff}
.rxn-pct{font-size:10px;color:#444}
.hidden{display:none!important}
/* Scrollbar none globally */
*{scrollbar-width:none}
*::-webkit-scrollbar{display:none}
</style>
</head>
<body>

<div id="hdr">
  <div>
    <div class="logo" id="app-title" contenteditable="true" spellcheck="false" title="Toca para editar">‚õ∞ Trail 44K</div>
    <div class="logo-sub">27 JUN 2026 ¬∑ 1500m D+</div>
  </div>
  <div id="race-countdown"></div>
</div>

<div id="tab-cal">
  <div id="week-nav">
    <button class="nav-btn" id="btn-prev">‚Äπ</button>
    <div id="week-info">
      <div id="week-num"></div>
      <div id="week-dates"></div>
      <div id="phase-badge"></div>
      <div id="week-km"></div>
    </div>
    <button class="nav-btn" id="btn-next">‚Ä∫</button>
  </div>
  <div id="swap-banner">üìå MODO INTERCAMBIO ‚Äî toca otro d√≠a para mover ¬∑ toca el mismo para cancelar</div>
  <div id="legend"></div>
  <div id="cards-wrap"><div id="cards-grid"></div></div>
  <div class="drag-hint">MANT√âN PRESIONADO PARA INTERCAMBIAR ¬∑ TOCA PARA DETALLES</div>
</div>

<div id="tab-stats" class="hidden">
  <div class="stat-grid" id="stat-grid"></div>
  <div class="chart-card">
    <div class="chart-ttl">km por semana ‚Äî planificado vs real</div>
    <canvas id="chart-km" height="190"></canvas>
  </div>
  <div class="chart-card">
    <div class="chart-ttl">tiempo de entrenamiento semanal (minutos)</div>
    <canvas id="chart-t" height="160"></canvas>
  </div>
  <div class="chart-card">
    <div class="chart-ttl">historial de sensaciones</div>
    <div class="rxn-sum" id="rxn-sum"></div>
  </div>
</div>

<div id="tabbar">
  <button class="tab-btn active" id="tbtn-cal" onclick="switchTab('cal')">
    <span class="tab-icon">üìÖ</span>CALENDARIO
  </button>
  <button class="tab-btn" id="tbtn-stats" onclick="switchTab('stats')">
    <span class="tab-icon">üìä</span>ANAL√çTICAS
  </button>
</div>

<!-- MODAL -->
<div id="modal-overlay" onclick="closeModal(event)">
  <div id="modal">
    <div class="m-handle"></div>
    <div class="m-day" id="m-day"></div>
    <div id="m-title"></div>
    <div id="m-chips"></div>
    <div id="m-desc"></div>
    <div class="m-sec">Registrar entrenamiento real</div>
    <div class="m-lbl">TIEMPO REAL</div>
    <div class="m-time-row">
      <div><div class="m-lbl-sub">hh</div><input class="m-input" id="m-th" type="number" min="0" max="23" inputmode="numeric"></div>
      <div><div class="m-lbl-sub">mm</div><input class="m-input" id="m-tm" type="number" min="0" max="59" inputmode="numeric"></div>
      <div><div class="m-lbl-sub">ss</div><input class="m-input" id="m-ts" type="number" min="0" max="59" inputmode="numeric"></div>
    </div>
    <div class="m-dist-row">
      <div class="m-lbl">DISTANCIA (km)</div>
      <input class="m-input-dist" id="m-dist" type="number" min="0" step="0.1" inputmode="decimal">
    </div>
    <div class="m-pace" id="m-pace"></div>
    <div class="m-rxn-row">
      <span class="m-rxn-lbl">SENSACI√ìN</span>
      <button class="m-rxn-btn" data-e="üòä" onclick="reactModal('üòä')">üòä</button>
      <button class="m-rxn-btn" data-e="üòê" onclick="reactModal('üòê')">üòê</button>
      <button class="m-rxn-btn" data-e="üòû" onclick="reactModal('üòû')">üòû</button>
    </div>
    <button id="m-save" onclick="saveLog()">GUARDAR ENTRENAMIENTO</button>
    <div id="m-saved">‚úì GUARDADO</div>
    <div id="m-gpx">Pr√≥ximamente: sincronizaci√≥n con archivos GPX üó∫</div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATOS DE ENTRENAMIENTO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const WEEKS = [
  {num:1,dates:"19‚Äì22 Feb",phase:"BASE",totalKm:24,days:[
    {id:"w1d0",date:"2026-02-19",label:"Jue 19 Feb",session:"Rodaje suave trail",type:"SUAVE",km:8,desc:"Terreno natural, 6:40/km. Activa piernas. 5min caminata de calentamiento antes de arrancar."},
    {id:"w1d1",date:"2026-02-20",label:"Vie 20 Feb",session:"Fuerza ‚Äì Tren inferior",type:"FUERZA",km:0,desc:"Sentadillas, estocadas, peso muerto rumano, elevaciones de tal√≥n, core (plancha, bird-dog). 3√ó12."},
    {id:"w1d2",date:"2026-02-21",label:"S√°b 21 Feb",session:"Trail con desnivel",type:"MEDIO",km:12,desc:"400m D+. Sube caminando las pendientes >10%. Baja controlado. Superficies irregulares."},
    {id:"w1d3",date:"2026-02-22",label:"Dom 22 Feb",session:"Recuperaci√≥n activa",type:"SUAVE",km:4,desc:"Ritmo suave 7:00/km. Terreno plano. Corto e indoloro."},
  ]},
  {num:2,dates:"23 Feb ‚Äì 1 Mar",phase:"BASE",totalKm:35,days:[
    {id:"w2d0",date:"2026-02-23",label:"Lun 23 Feb",session:"Fuerza ‚Äì Superior + core",type:"FUERZA",km:0,desc:"Press inclinado, remo con mancuerna, fondos, planchas con variantes. 3√ó12."},
    {id:"w2d1",date:"2026-02-24",label:"Mar 24 Feb",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso activo o movilidad 20min."},
    {id:"w2d2",date:"2026-02-25",label:"Mi√© 25 Feb",session:"Intervalos por tiempo",type:"INTENSO",km:10,desc:"WU 10min ‚Üí 6√ó(3min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w2d3",date:"2026-02-26",label:"Jue 26 Feb",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso."},
    {id:"w2d4",date:"2026-02-27",label:"Vie 27 Feb",session:"Rodaje suave",type:"SUAVE",km:11,desc:"Ritmo 6:40/km. Terreno mixto. Hidrataci√≥n con mochila."},
    {id:"w2d5",date:"2026-02-28",label:"S√°b 28 Feb",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso."},
    {id:"w2d6",date:"2026-03-01",label:"Dom 1 Mar",session:"Largo trail 14km",type:"MEDIO",km:14,desc:"500m D+. ~2h en pie. Camina pendientes. Practica nutrici√≥n en ruta."},
  ]},
  {num:3,dates:"2‚Äì8 Mar",phase:"BASE",totalKm:46,days:[
    {id:"w3d0",date:"2026-03-02",label:"Lun 2 Mar",session:"Fuerza ‚Äì Tren inferior",type:"FUERZA",km:0,desc:"A√±ade carga. Sentadilla b√∫lgara, hip thrust, plancha lateral. Tobillo con bandas."},
    {id:"w3d1",date:"2026-03-03",label:"Mar 3 Mar",session:"Rodaje suave",type:"SUAVE",km:8,desc:"6:40/km. Primer trote de la semana. Piernas sueltas."},
    {id:"w3d2",date:"2026-03-04",label:"Mi√© 4 Mar",session:"Intervalos por tiempo",type:"INTENSO",km:10,desc:"WU 10min ‚Üí 6√ó(3min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w3d3",date:"2026-03-05",label:"Jue 5 Mar",session:"Rodaje suave",type:"SUAVE",km:8,desc:"6:40/km. Terreno variado. Mant√©n conversaci√≥n fluida."},
    {id:"w3d4",date:"2026-03-06",label:"Vie 6 Mar",session:"Rodaje recuperaci√≥n",type:"SUAVE",km:6,desc:"6:50/km. Corto y suave. Prepara piernas para el largo del s√°bado."},
    {id:"w3d5",date:"2026-03-07",label:"S√°b 7 Mar",session:"Largo trail 16km",type:"INTENSO",km:16,desc:"650m D+. Busca rutas con tierra h√∫meda. Prueba zapatillas definitivas."},
    {id:"w3d6",date:"2026-03-08",label:"Dom 8 Mar",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo o caminata 20min."},
  ]},
  {num:4,dates:"9‚Äì15 Mar",phase:"RECUPERACI√ìN",totalKm:38,days:[
    {id:"w4d0",date:"2026-03-09",label:"Lun 9 Mar",session:"Rodaje suave",type:"SUAVE",km:8,desc:"Semana de recuperaci√≥n. 6:50/km. Sin presi√≥n."},
    {id:"w4d1",date:"2026-03-10",label:"Mar 10 Mar",session:"Repeticiones",type:"INTENSO",km:9,desc:"WU 10min ‚Üí 5√ó(3min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w4d2",date:"2026-03-11",label:"Mi√© 11 Mar",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso activo: caminata, estiramientos, foam roller."},
    {id:"w4d3",date:"2026-03-12",label:"Jue 12 Mar",session:"Rodaje suave",type:"SUAVE",km:9,desc:"6:40/km. Terreno moderado."},
    {id:"w4d4",date:"2026-03-13",label:"Vie 13 Mar",session:"Largo trail 13km",type:"MEDIO",km:13,desc:"500m D+. Largo moderado de recuperaci√≥n. Ritmo c√≥modo."},
    {id:"w4d5",date:"2026-03-14",label:"S√°b 14 Mar",session:"Fuerza ‚Äì Movilidad",type:"FUERZA",km:0,desc:"Reduce carga 40%. Movilidad de cadera, tobillos y espalda. Foam roller. 40min."},
    {id:"w4d6",date:"2026-03-15",label:"Dom 15 Mar",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo."},
  ]},
  {num:5,dates:"16‚Äì22 Mar",phase:"DESARROLLO",totalKm:55,days:[
    {id:"w5d0",date:"2026-03-16",label:"Lun 16 Mar",session:"Fuerza ‚Äì Tren inferior",type:"FUERZA",km:0,desc:"Progresa en carga. Propioceptivo en superficie inestable. Paso de valla lateral."},
    {id:"w5d1",date:"2026-03-17",label:"Mar 17 Mar",session:"Intervalos",type:"INTENSO",km:11,desc:"WU 10min ‚Üí 7√ó(3min a 5:00/km / 90seg trote) ‚Üí CD 10min. Ritmo constante en todos."},
    {id:"w5d2",date:"2026-03-18",label:"Mi√© 18 Mar",session:"Rodaje suave",type:"SUAVE",km:10,desc:"6:40/km. Terreno trail. Trabaja postura en bajadas."},
    {id:"w5d3",date:"2026-03-19",label:"Jue 19 Mar",session:"Tempo",type:"MEDIO",km:11,desc:"WU 10min ‚Üí 2√ó10min a 5:15/km con 3min pausa ‚Üí CD 10min."},
    {id:"w5d4",date:"2026-03-20",label:"Vie 20 Mar",session:"Rodaje recuperaci√≥n",type:"SUAVE",km:6,desc:"6:50/km. Corto y suelto. Activa sin fatigar."},
    {id:"w5d5",date:"2026-03-21",label:"S√°b 21 Mar",session:"Largo trail 20km",type:"INTENSO",km:20,desc:"800m D+. Primer 20km. Administra energ√≠a desde el km 1. Practica nutrici√≥n."},
    {id:"w5d6",date:"2026-03-22",label:"Dom 22 Mar",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso. Piernas en alto 15min."},
  ]},
  {num:6,dates:"23‚Äì29 Mar",phase:"DESARROLLO",totalKm:50,days:[
    {id:"w6d0",date:"2026-03-23",label:"Lun 23 Mar",session:"Rodaje suave",type:"SUAVE",km:10,desc:"6:40/km. Piernas activas tras el 20km del s√°bado."},
    {id:"w6d1",date:"2026-03-24",label:"Mar 24 Mar",session:"Repeticiones",type:"INTENSO",km:12,desc:"WU 10min ‚Üí 3√ó10min a 5:10/km con 3min pausa ‚Üí CD 10min."},
    {id:"w6d2",date:"2026-03-25",label:"Mi√© 25 Mar",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso activo. Movilidad 20min."},
    {id:"w6d3",date:"2026-03-26",label:"Jue 26 Mar",session:"Rodaje suave",type:"SUAVE",km:10,desc:"6:40/km. Terreno mojado si posible. Practica cadencia en barro."},
    {id:"w6d4",date:"2026-03-27",label:"Vie 27 Mar",session:"Largo trail 18km",type:"INTENSO",km:18,desc:"800m D+. Ritmo c√≥modo. Entrena nutrici√≥n en movimiento."},
    {id:"w6d5",date:"2026-03-28",label:"S√°b 28 Mar",session:"Fuerza ‚Äì Full body",type:"FUERZA",km:0,desc:"Circuito funcional: sentadilla goblet, press hombro, remo, core antirotaci√≥n. 4 rondas."},
    {id:"w6d6",date:"2026-03-29",label:"Dom 29 Mar",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo."},
  ]},
  {num:7,dates:"30 Mar ‚Äì 5 Abr",phase:"DESARROLLO",totalKm:62,days:[
    {id:"w7d0",date:"2026-03-30",label:"Lun 30 Mar",session:"Fuerza ‚Äì Tren inferior",type:"FUERZA",km:0,desc:"Gl√∫teos y estabilizadores de rodilla. Box step-up, hip thrust pesado."},
    {id:"w7d1",date:"2026-03-31",label:"Mar 31 Mar",session:"Intervalos largos",type:"INTENSO",km:12,desc:"WU 10min ‚Üí 5√ó(4min a 5:05/km / 2min trote) ‚Üí CD 10min."},
    {id:"w7d2",date:"2026-04-01",label:"Mi√© 1 Abr",session:"Rodaje suave",type:"SUAVE",km:11,desc:"6:40/km. 4‚Äì5 acelerones de 30seg al final."},
    {id:"w7d3",date:"2026-04-02",label:"Jue 2 Abr",session:"Tempo",type:"MEDIO",km:12,desc:"WU 10min ‚Üí 2√ó12min a 5:10/km con 4min pausa ‚Üí CD 10min."},
    {id:"w7d4",date:"2026-04-03",label:"Vie 3 Abr",session:"Rodaje recuperaci√≥n",type:"SUAVE",km:7,desc:"6:50/km. Suave. Prepara piernas para el largo de ma√±ana."},
    {id:"w7d5",date:"2026-04-04",label:"S√°b 4 Abr",session:"Largo trail 23km",type:"INTENSO",km:23,desc:"1050m D+. Sale temprano. Bastones si los usar√°s en carrera."},
    {id:"w7d6",date:"2026-04-05",label:"Dom 5 Abr",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso. Nutrici√≥n de recuperaci√≥n."},
  ]},
  {num:8,dates:"6‚Äì12 Abr",phase:"RECUPERACI√ìN",totalKm:40,days:[
    {id:"w8d0",date:"2026-04-06",label:"Lun 6 Abr",session:"Rodaje suave",type:"SUAVE",km:9,desc:"Semana de recuperaci√≥n. 6:50/km."},
    {id:"w8d1",date:"2026-04-07",label:"Mar 7 Abr",session:"Repeticiones suaves",type:"INTENSO",km:10,desc:"WU 10min ‚Üí 4√ó(3min a 5:10/km / 2min trote) ‚Üí CD 10min."},
    {id:"w8d2",date:"2026-04-08",label:"Mi√© 8 Abr",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso. Movilidad articular 20min."},
    {id:"w8d3",date:"2026-04-09",label:"Jue 9 Abr",session:"Rodaje suave",type:"SUAVE",km:9,desc:"6:40/km. Terreno plano. T√©cnica de zancada."},
    {id:"w8d4",date:"2026-04-10",label:"Vie 10 Abr",session:"Largo trail 14km",type:"MEDIO",km:14,desc:"550m D+. Largo de recuperaci√≥n. Ritmo c√≥modo."},
    {id:"w8d5",date:"2026-04-11",label:"S√°b 11 Abr",session:"Fuerza ‚Äì Movilidad",type:"FUERZA",km:0,desc:"Reduce carga 40%. Yoga o movilidad de cadena posterior."},
    {id:"w8d6",date:"2026-04-12",label:"Dom 12 Abr",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo."},
  ]},
  {num:9,dates:"13‚Äì19 Abr",phase:"PICO",totalKm:66,days:[
    {id:"w9d0",date:"2026-04-13",label:"Lun 13 Abr",session:"Fuerza ‚Äì Potencia",type:"FUERZA",km:0,desc:"Sentadilla explosiva, saltos al caj√≥n, hip thrust. Potencia para subidas."},
    {id:"w9d1",date:"2026-04-14",label:"Mar 14 Abr",session:"Intervalos por tiempo",type:"INTENSO",km:13,desc:"WU 10min ‚Üí 6√ó(4min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w9d2",date:"2026-04-15",label:"Mi√© 15 Abr",session:"Rodaje suave",type:"SUAVE",km:12,desc:"6:40/km. Terreno trail. Gestiona bien el ritmo."},
    {id:"w9d3",date:"2026-04-16",label:"Jue 16 Abr",session:"Tempo trail",type:"MEDIO",km:13,desc:"WU 10min ‚Üí 2√ó14min a 5:10/km con 4min pausa ‚Üí CD 10min."},
    {id:"w9d4",date:"2026-04-17",label:"Vie 17 Abr",session:"Rodaje recuperaci√≥n",type:"SUAVE",km:7,desc:"6:50/km. Suave. Prepara piernas para el largo."},
    {id:"w9d5",date:"2026-04-18",label:"S√°b 18 Abr",session:"Largo trail 26km",type:"INTENSO",km:26,desc:"1200m D+. Simula condiciones de barro. T√©cnica de bajada."},
    {id:"w9d6",date:"2026-04-19",label:"Dom 19 Abr",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso. Hidrataci√≥n y nutrici√≥n post-largo."},
  ]},
  {num:10,dates:"20‚Äì26 Abr",phase:"PICO",totalKm:55,days:[
    {id:"w10d0",date:"2026-04-20",label:"Lun 20 Abr",session:"Rodaje suave",type:"SUAVE",km:12,desc:"6:40/km. Recupera del 26km del s√°bado."},
    {id:"w10d1",date:"2026-04-21",label:"Mar 21 Abr",session:"Repeticiones largas",type:"INTENSO",km:14,desc:"WU 10min ‚Üí 4√ó(6min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w10d2",date:"2026-04-22",label:"Mi√© 22 Abr",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso activo. Core en casa. 20min."},
    {id:"w10d3",date:"2026-04-23",label:"Jue 23 Abr",session:"Rodaje suave",type:"SUAVE",km:12,desc:"6:40/km. Eval√∫a fatiga acumulada."},
    {id:"w10d4",date:"2026-04-24",label:"Vie 24 Abr",session:"Largo trail 22km",type:"INTENSO",km:22,desc:"1000m D+. Camina pendientes >12%, corre el resto."},
    {id:"w10d5",date:"2026-04-25",label:"S√°b 25 Abr",session:"Fuerza ‚Äì Full body",type:"FUERZA",km:0,desc:"Mant√©n intensidad. Core con inestabilidad. 4 rondas."},
    {id:"w10d6",date:"2026-04-26",label:"Dom 26 Abr",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo."},
  ]},
  {num:11,dates:"27 Abr ‚Äì 3 May",phase:"PICO",totalKm:73,days:[
    {id:"w11d0",date:"2026-04-27",label:"Lun 27 Abr",session:"Fuerza ‚Äì Tren inferior",type:"FUERZA",km:0,desc:"Progresa en carga. Consolida base muscular. Estabilizadores de tobillo."},
    {id:"w11d1",date:"2026-04-28",label:"Mar 28 Abr",session:"Intervalos espec√≠ficos",type:"INTENSO",km:13,desc:"WU 10min ‚Üí 5√ó(5min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w11d2",date:"2026-04-29",label:"Mi√© 29 Abr",session:"Rodaje suave",type:"SUAVE",km:13,desc:"6:40/km. Terreno trail preferentemente."},
    {id:"w11d3",date:"2026-04-30",label:"Jue 30 Abr",session:"Tempo",type:"MEDIO",km:13,desc:"WU 10min ‚Üí 3√ó12min a 5:10/km con 3min pausa ‚Üí CD 10min."},
    {id:"w11d4",date:"2026-05-01",label:"Vie 1 May",session:"Rodaje recuperaci√≥n",type:"SUAVE",km:9,desc:"6:50/km. No sobrecargar la v√≠spera del largo."},
    {id:"w11d5",date:"2026-05-02",label:"S√°b 2 May",session:"Largo trail 29km",type:"INTENSO",km:29,desc:"1350m D+. Equipo de carrera completo. Nutrici√≥n cada 45‚Äì60min."},
    {id:"w11d6",date:"2026-05-03",label:"Dom 3 May",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso. Piernas en alto. Nutrici√≥n proteica."},
  ]},
  {num:12,dates:"4‚Äì10 May",phase:"RECUPERACI√ìN",totalKm:46,days:[
    {id:"w12d0",date:"2026-05-04",label:"Lun 4 May",session:"Rodaje suave",type:"SUAVE",km:10,desc:"Semana de recuperaci√≥n. 6:50/km."},
    {id:"w12d1",date:"2026-05-05",label:"Mar 5 May",session:"Repeticiones suaves",type:"INTENSO",km:11,desc:"WU 10min ‚Üí 4√ó(4min a 5:10/km / 2min trote) ‚Üí CD 10min."},
    {id:"w12d2",date:"2026-05-06",label:"Mi√© 6 May",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso. Regeneraci√≥n muscular."},
    {id:"w12d3",date:"2026-05-07",label:"Jue 7 May",session:"Rodaje suave",type:"SUAVE",km:11,desc:"6:40/km. Terreno moderado. Sin presi√≥n."},
    {id:"w12d4",date:"2026-05-08",label:"Vie 8 May",session:"Largo trail 16km",type:"MEDIO",km:16,desc:"650m D+. Largo moderado. Revisi√≥n de equipo."},
    {id:"w12d5",date:"2026-05-09",label:"S√°b 9 May",session:"Fuerza ligera",type:"FUERZA",km:0,desc:"Reduce carga 50%. Movilidad, estiramientos. 30‚Äì40min."},
    {id:"w12d6",date:"2026-05-10",label:"Dom 10 May",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo."},
  ]},
  {num:13,dates:"11‚Äì17 May",phase:"PICO",totalKm:76,days:[
    {id:"w13d0",date:"2026-05-11",label:"Lun 11 May",session:"Fuerza ‚Äì Mantenimiento",type:"FUERZA",km:0,desc:"2‚Äì3 series por ejercicio. Carga moderada. Mant√©n el est√≠mulo."},
    {id:"w13d1",date:"2026-05-12",label:"Mar 12 May",session:"Intervalos",type:"INTENSO",km:14,desc:"WU 10min ‚Üí 5√ó(5min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w13d2",date:"2026-05-13",label:"Mi√© 13 May",session:"Rodaje suave",type:"SUAVE",km:13,desc:"6:40/km. Terreno trail con desnivel suave."},
    {id:"w13d3",date:"2026-05-14",label:"Jue 14 May",session:"Tempo espec√≠fico trail",type:"MEDIO",km:14,desc:"WU 10min ‚Üí 3√ó14min a 5:10/km en trail con desnivel ‚Üí CD 10min."},
    {id:"w13d4",date:"2026-05-15",label:"Vie 15 May",session:"Rodaje recuperaci√≥n",type:"SUAVE",km:9,desc:"6:50/km. Suave y suelto."},
    {id:"w13d5",date:"2026-05-16",label:"S√°b 16 May",session:"Largo trail 32km",type:"INTENSO",km:32,desc:"1450m D+. Primer 32km. Ultra conservador los primeros 10km."},
    {id:"w13d6",date:"2026-05-17",label:"Dom 17 May",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo. Prioriza recuperaci√≥n absoluta."},
  ]},
  {num:14,dates:"18‚Äì24 May",phase:"PICO",totalKm:57,days:[
    {id:"w14d0",date:"2026-05-18",label:"Lun 18 May",session:"Rodaje suave",type:"SUAVE",km:13,desc:"6:40/km. Tras el 32km, movimiento suave."},
    {id:"w14d1",date:"2026-05-19",label:"Mar 19 May",session:"Repeticiones largas",type:"INTENSO",km:14,desc:"WU 10min ‚Üí 4√ó(6min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w14d2",date:"2026-05-20",label:"Mi√© 20 May",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso activo. Movilidad de cadera y tobillos."},
    {id:"w14d3",date:"2026-05-21",label:"Jue 21 May",session:"Rodaje suave",type:"SUAVE",km:13,desc:"6:40/km. Terreno trail. Mant√©n consistencia."},
    {id:"w14d4",date:"2026-05-22",label:"Vie 22 May",session:"Largo trail 26km",type:"INTENSO",km:26,desc:"1200m D+. Sale conservador. √öltima larga antes del peak."},
    {id:"w14d5",date:"2026-05-23",label:"S√°b 23 May",session:"Fuerza ‚Äì Mantenimiento",type:"FUERZA",km:0,desc:"2‚Äì3 series. Core fuerte para los 44km. Sin buscar fatiga."},
    {id:"w14d6",date:"2026-05-24",label:"Dom 24 May",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo. Mentalizaci√≥n para el peak."},
  ]},
  {num:15,dates:"25‚Äì31 May",phase:"PEAK üî∫",totalKm:78,days:[
    {id:"w15d0",date:"2026-05-25",label:"Lun 25 May",session:"Fuerza ‚Äì Mantenimiento",type:"FUERZA",km:0,desc:"√öltima fuerza de alta intensidad del plan."},
    {id:"w15d1",date:"2026-05-26",label:"Mar 26 May",session:"Intervalos cortos",type:"INTENSO",km:13,desc:"WU 10min ‚Üí 5√ó(4min a 5:00/km / 2min trote) ‚Üí CD 10min."},
    {id:"w15d2",date:"2026-05-27",label:"Mi√© 27 May",session:"Rodaje suave",type:"SUAVE",km:12,desc:"6:40/km. Terreno trail. Suave y controlado."},
    {id:"w15d3",date:"2026-05-28",label:"Jue 28 May",session:"Rodaje suave-medio",type:"MEDIO",km:10,desc:"Suave-medio. No exprimas: el largo del s√°bado es el objetivo."},
    {id:"w15d4",date:"2026-05-29",label:"Vie 29 May",session:"Rodaje recuperaci√≥n",type:"SUAVE",km:8,desc:"6:50/km. Muy suave. √öltimos pasos antes del peak."},
    {id:"w15d5",date:"2026-05-30",label:"S√°b 30 May üî∫",session:"PEAK ‚Äì Largo 35km",type:"INTENSO",km:35,desc:"1500m D+. TIRADA PEAK. Sale ultra conservador: primeros 15km al 70%. Equipo completo, nutrici√≥n cada 45min. Simula lluvia y barro."},
    {id:"w15d6",date:"2026-05-31",label:"Dom 31 May",session:"Descanso absoluto",type:"DESCANSO",km:0,desc:"Descanso absoluto. Inicio del taper. Hidrataci√≥n y sue√±o prioridad."},
  ]},
  {num:16,dates:"1‚Äì7 Jun",phase:"TAPER",totalKm:46,days:[
    {id:"w16d0",date:"2026-06-01",label:"Lun 1 Jun",session:"Rodaje suave",type:"SUAVE",km:11,desc:"Primer d√≠a de taper. 6:40/km."},
    {id:"w16d1",date:"2026-06-02",label:"Mar 2 Jun",session:"Repeticiones taper",type:"MEDIO",km:11,desc:"WU 10min ‚Üí 2√ó10min a ritmo umbral ‚Üí CD 10min."},
    {id:"w16d2",date:"2026-06-03",label:"Mi√© 3 Jun",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso activo. Repasa log√≠stica de carrera."},
    {id:"w16d3",date:"2026-06-04",label:"Jue 4 Jun",session:"Rodaje suave",type:"SUAVE",km:11,desc:"6:40/km. √öltimo rodaje de distancia entre semana."},
    {id:"w16d4",date:"2026-06-05",label:"Vie 5 Jun",session:"Largo trail 20km",type:"MEDIO",km:20,desc:"800m D+. Largo reducido. Ritmo c√≥modo."},
    {id:"w16d5",date:"2026-06-06",label:"S√°b 6 Jun",session:"Fuerza ligera",type:"FUERZA",km:0,desc:"2 series por ejercicio. Activaci√≥n neuromuscular."},
    {id:"w16d6",date:"2026-06-07",label:"Dom 7 Jun",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo."},
  ]},
  {num:17,dates:"8‚Äì14 Jun",phase:"TAPER",totalKm:34,days:[
    {id:"w17d0",date:"2026-06-08",label:"Lun 8 Jun",session:"Fuerza muy ligera",type:"FUERZA",km:0,desc:"1‚Äì2 series. Activaci√≥n articular. Movilidad 20min."},
    {id:"w17d1",date:"2026-06-09",label:"Mar 9 Jun",session:"Intervalos cortos",type:"MEDIO",km:9,desc:"WU 10min ‚Üí 4√ó(3min a ritmo fuerte / 90seg trote) ‚Üí CD 10min."},
    {id:"w17d2",date:"2026-06-10",label:"Mi√© 10 Jun",session:"Rodaje suave",type:"SUAVE",km:7,desc:"6:40/km. Terreno trail. Visualiza la carrera."},
    {id:"w17d3",date:"2026-06-11",label:"Jue 11 Jun",session:"Rodaje suave",type:"SUAVE",km:6,desc:"6:50/km. Corto y suave."},
    {id:"w17d4",date:"2026-06-12",label:"Vie 12 Jun",session:"Rodaje recuperaci√≥n",type:"SUAVE",km:5,desc:"6:50/km. 25‚Äì30min muy suave."},
    {id:"w17d5",date:"2026-06-13",label:"S√°b 13 Jun",session:"Trail suave 12km",type:"SUAVE",km:12,desc:"350m D+. Ritmo muy c√≥modo. √öltima tirada larga."},
    {id:"w17d6",date:"2026-06-14",label:"Dom 14 Jun",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso completo."},
  ]},
  {num:18,dates:"15‚Äì21 Jun",phase:"TAPER FINAL",totalKm:17,days:[
    {id:"w18d0",date:"2026-06-15",label:"Lun 15 Jun",session:"Rodaje suave",type:"SUAVE",km:7,desc:"6:40/km. 7km se siente trivial: eso buscamos."},
    {id:"w18d1",date:"2026-06-16",label:"Mar 16 Jun",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso activo. Caminata 20min."},
    {id:"w18d2",date:"2026-06-17",label:"Mi√© 17 Jun",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso. Hidrataci√≥n √≥ptima."},
    {id:"w18d3",date:"2026-06-18",label:"Jue 18 Jun",session:"Rodaje suave",type:"SUAVE",km:5,desc:"6:40/km. 25‚Äì30min. Mantiene el sistema activo."},
    {id:"w18d4",date:"2026-06-19",label:"Vie 19 Jun",session:"Rodaje + strides",type:"SUAVE",km:5,desc:"6:40/km con 4√ó15seg strides al final."},
    {id:"w18d5",date:"2026-06-20",label:"S√°b 20 Jun",session:"Movilidad + activaci√≥n",type:"FUERZA",km:0,desc:"Sin pesas. Yoga, foam roller, activaci√≥n. 20‚Äì30min."},
    {id:"w18d6",date:"2026-06-21",label:"Dom 21 Jun",session:"Descanso",type:"DESCANSO",km:0,desc:"Descanso. Carga de carbos gradual. Duerme temprano."},
  ]},
  {num:"üèÅ",dates:"22‚Äì27 Jun",phase:"CARRERA",totalKm:47,days:[
    {id:"wRd0",date:"2026-06-22",label:"Lun 22 Jun",session:"Trote + strides",type:"SUAVE",km:3,desc:"20min trote suave + 4√ó15seg strides."},
    {id:"wRd1",date:"2026-06-23",label:"Mar 23 Jun",session:"Movilidad + log√≠stica",type:"DESCANSO",km:0,desc:"Prepara mochila y equipo. Activaci√≥n ligera 15min."},
    {id:"wRd2",date:"2026-06-24",label:"Mi√© 24 Jun",session:"Descanso activo",type:"DESCANSO",km:0,desc:"Caminata 20‚Äì30min. Hidrataci√≥n. Carga de carbos gradual."},
    {id:"wRd3",date:"2026-06-25",label:"Jue 25 Jun",session:"Descanso",type:"DESCANSO",km:0,desc:"Viaje si necesario. Recoge dorsal. Duerme temprano."},
    {id:"wRd4",date:"2026-06-26",label:"Vie 26 Jun",session:"Descanso pre-carrera",type:"DESCANSO",km:0,desc:"Descanso completo. Cena con carbos. Acu√©state temprano."},
    {id:"wRd5",date:"2026-06-27",label:"S√°b 27 Jun üèÅ",session:"CARRERA 44km",type:"INTENSO",km:44,desc:"1500m D+. ¬°A correr! Sale conservador: primeros 10km al 70%. Gestiona energ√≠a, hidrataci√≥n y t√©cnica en barro."},
  ]},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ESTADO Y STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const S = {
  get:(k)=>{try{return JSON.parse(localStorage.getItem(k))}catch(e){return null}},
  set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch(e){}}
};

const TYPE = {
  // SUAVE=verde=#ffa477 MEDIO=amarillo=#ffbb77 INTENSO=rojo=#ac6d77 FUERZA=azul=#b85c4e
  SUAVE:   {bg:'#1f0f08',bd:'#7a4030',tx:'#ffa477',ch:'#2a1208',gl:'rgba(255,164,119,.45)'},
  MEDIO:   {bg:'#1f1408',bd:'#7a5020',tx:'#ffbb77',ch:'#2a1a08',gl:'rgba(255,187,119,.45)'},
  INTENSO: {bg:'#170a0d',bd:'#5a2a35',tx:'#ac6d77',ch:'#200810',gl:'rgba(172,109,119,.45)'},
  FUERZA:  {bg:'#130a18',bd:'#4a2a60',tx:'#b85c4e',ch:'#1c0a20',gl:'rgba(184,92,78,.45)'},
  DESCANSO:{bg:'#0e0e12',bd:'#252530',tx:'#4a4a5a',ch:'#141420',gl:'transparent'},
};
const PHASE_C = {'BASE':'#7ab8d4','DESARROLLO':'#ffbb77','PICO':'#ac6d77','PEAK üî∫':'#ac6d77','RECUPERACI√ìN':'#b8a0d4','TAPER':'#9a85c4','TAPER FINAL':'#9a85c4','CARRERA':'#ffbb77'};

let st = {
  weekIdx: 0,
  tab: 'cal',
  reactions: S.get('tw_rxn') || {},
  logs:      S.get('tw_logs') || {},
  weeks:     S.get('tw_weeks') || WEEKS,
  selected:  null,
  modalDay:  null,
  chartKm:   null,
  chartT:    null,
};

// Find current week
const TODAY = new Date().toISOString().split('T')[0];
const ti = st.weeks.findIndex(w=>w.days.some(d=>d.date===TODAY));
if(ti>=0) st.weekIdx=ti;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COUNTDOWN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateCountdown(){
  const race=new Date('2026-06-27');
  const now=new Date();
  const diff=Math.ceil((race-now)/(1000*60*60*24));
  const el=document.getElementById('race-countdown');
  if(diff>0){el.innerHTML=`<div style="color:#555;font-size:9px;letter-spacing:1px">FALTAN</div><div class="cd-num" style="color:#f1c40f">${diff}</div><div style="color:#555;font-size:9px;letter-spacing:1px">D√çAS</div>`}
  else if(diff===0){el.innerHTML=`<div class="cd-num" style="color:#e74c3c">HOY üèÅ</div>`}
  else{el.innerHTML=`<div style="color:#2ecc71;font-size:12px;font-weight:700">¬°TERMINADO! üèÜ</div>`}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER CALENDAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCal(){
  const w=st.weeks[st.weekIdx];
  // Header
  document.getElementById('week-num').textContent=
    typeof w.num==='number'?`SEM. ${String(w.num).padStart(2,'0')}`:'CARRERA üèÅ';
  document.getElementById('week-dates').textContent=w.dates;
  const pc=PHASE_C[w.phase]||'#888';
  const pb=document.getElementById('phase-badge');
  pb.textContent=w.phase;
  pb.style.cssText=`display:inline-block;margin-top:4px;padding:2px 10px;border-radius:12px;font-size:11px;font-weight:700;letter-spacing:1px;background:${pc}22;color:${pc};border:1px solid ${pc}44`;
  document.getElementById('week-km').textContent=`${w.totalKm} km planificados`;
  // Legend
  const lg=document.getElementById('legend');
  lg.innerHTML=['SUAVE','MEDIO','INTENSO','FUERZA','DESCANSO'].map(t=>
    `<div class="lg-item" style="color:${TYPE[t].tx}"><div class="lg-dot" style="background:${TYPE[t].bd}"></div>${t}</div>`
  ).join('');
  // Swap banner
  document.getElementById('swap-banner').classList.toggle('show', st.selected!==null);
  // Cards
  const grid=document.getElementById('cards-grid');
  grid.innerHTML='';
  w.days.forEach((day,i)=>{
    const ts=TYPE[day.type];
    const log=st.logs[day.id];
    const rxn=st.reactions[day.id];
    const isToday=day.date===TODAY;
    const isSel=st.selected===i;
    const isTarget=st.selected!==null && !isSel;
    const card=document.createElement('div');
    card.className=`day-card tc-${day.type}${isSel?' selected':''}${isTarget?' swap-target':''}`;
    card.style.borderColor=isSel?ts.tx:ts.bd;
    card.style.boxShadow=isSel?`0 0 0 2px ${ts.tx},0 0 20px ${ts.gl}`:isToday?`0 0 0 1.5px ${ts.tx}60`:'none';
    const rxnBtns=['üòä','üòê','üòû'].map(em=>{
      let cls='rxn-btn';
      if(rxn){cls+=(rxn===em)?' active':' inactive';}
      return `<button class="${cls}" onclick="cardReact(event,'${day.id}','${em}')">${em}</button>`;
    }).join('');
    card.innerHTML=`
      <div class="swap-badge">MOVER</div>
      <div class="card-left">
        <div class="card-day">${isToday?'<span class="today-dot"></span>':''}${day.label}</div>
        <div class="card-session">${day.session}</div>
        <span class="card-chip">${day.type}</span>
        ${log?.distance?`<div class="card-logged">‚úì ${log.distance}km${log.time?' ¬∑ '+log.time:''}</div>`:''}
      </div>
      <div class="card-right">
        ${day.km>0?`<div class="card-km">${day.km}<span>km</span></div>`:''}
        <div class="card-reacts">${rxnBtns}</div>
      </div>
      ${log?.distance?'<div class="log-dot"></div>':''}
    `;
    // Tap/long-press
    let pressTimer;
    card.addEventListener('touchstart',()=>{
      pressTimer=setTimeout(()=>{
        if(st.selected===null){st.selected=i;renderCal();navigator.vibrate&&navigator.vibrate(60);}
      },500);
    },{passive:true});
    card.addEventListener('touchend',()=>clearTimeout(pressTimer),{passive:true});
    card.addEventListener('touchmove',()=>clearTimeout(pressTimer),{passive:true});
    card.addEventListener('click',e=>{
      if(e.target.closest('.rxn-btn'))return;
      if(st.selected!==null){
        if(st.selected===i){st.selected=null;renderCal();}
        else{swapCards(st.selected,i);st.selected=null;}
      } else {
        openModal(i);
      }
    });
    grid.appendChild(card);
  });
  // Scroll today into view
  const todayI=w.days.findIndex(d=>d.date===TODAY);
  if(todayI>=0){
    setTimeout(()=>{
      const c=grid.querySelectorAll('.day-card')[todayI];
      c&&c.scrollIntoView({behavior:'smooth',block:'nearest',inline:'center'});
    },120);
  }
}

function swapCards(a,b){
  const weeks=JSON.parse(JSON.stringify(st.weeks));
  const d=weeks[st.weekIdx].days;
  ['session','type','km','desc'].forEach(f=>{const tmp=d[a][f];d[a][f]=d[b][f];d[b][f]=tmp;});
  st.weeks=weeks;
  S.set('tw_weeks',weeks);
  renderCal();
}

function cardReact(e,dayId,emoji){
  e.stopPropagation();
  const cur=st.reactions[dayId];
  st.reactions={...st.reactions,[dayId]:cur===emoji?null:emoji};
  S.set('tw_rxn',st.reactions);
  renderCal();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Estimate target time for a workout (sec)
function estSeconds(day){
  if(day.km===0) return day.type==='FUERZA'?3600:0;
  const pace={SUAVE:400,MEDIO:320,INTENSO:370}[day.type]||360;
  return Math.round(day.km*pace);
}
function fmtTimeParts(sec){
  const h=Math.floor(sec/3600),m=Math.floor((sec%3600)/60),s=sec%60;
  return {h,m,s};
}
function calcPace(){
  const h=parseInt(document.getElementById('m-th').value)||0;
  const m=parseInt(document.getElementById('m-tm').value)||0;
  const s=parseInt(document.getElementById('m-ts').value)||0;
  const dist=parseFloat(document.getElementById('m-dist').value)||0;
  const paceEl=document.getElementById('m-pace');
  if(dist>0&&(h||m||s)){
    const totalSec=h*3600+m*60+s;
    const secPerKm=totalSec/dist;
    const pm=Math.floor(secPerKm/60),ps=Math.round(secPerKm%60);
    paceEl.textContent=`‚ü∂ ritmo medio ${pm}:${String(ps).padStart(2,'0')} /km`;
    paceEl.className='m-pace has-pace';
  } else {
    paceEl.textContent='';paceEl.className='m-pace';
  }
}
function openModal(i){
  const day=st.weeks[st.weekIdx].days[i];
  st.modalDay=day;
  const ts=TYPE[day.type];
  const log=st.logs[day.id];
  const rxn=st.reactions[day.id];
  document.getElementById('m-day').textContent=day.label;
  const mt=document.getElementById('m-title');
  mt.textContent=day.session;
  mt.style.color=ts.tx;
  document.getElementById('m-chips').innerHTML=
    `<span class="m-chip" style="background:${ts.ch};color:${ts.tx}">${day.type}</span>`+
    (day.km>0?`<span class="m-km" style="color:${ts.tx}">${day.km} km plan</span>`:'');
  document.getElementById('m-desc').textContent=day.desc;
  // Pre-fill time: saved log or estimated target
  if(log?.th!==undefined){
    document.getElementById('m-th').value=log.th;
    document.getElementById('m-tm').value=log.tm;
    document.getElementById('m-ts').value=log.ts;
  } else {
    const est=fmtTimeParts(estSeconds(day));
    document.getElementById('m-th').value=est.h||'';
    document.getElementById('m-tm').value=est.m||'';
    document.getElementById('m-ts').value=est.s||'';
  }
  // Pre-fill distance: saved or planned
  document.getElementById('m-dist').value=log?.distance||(day.km>0?day.km:'');
  // Bind pace calc to inputs
  ['m-th','m-tm','m-ts','m-dist'].forEach(id=>{
    const el=document.getElementById(id);
    el.oninput=calcPace;
  });
  calcPace();
  // Emoji state
  updateModalEmoji(rxn);
  const btn=document.getElementById('m-save');
  btn.style.background=`linear-gradient(135deg,${ts.bd},${ts.tx}80)`;
  btn.style.display='block';
  document.getElementById('m-saved').style.display='none';
  const ov=document.getElementById('modal-overlay');
  ov.style.display='flex';
  ov.classList.add('open');
}
function updateModalEmoji(rxn){
  document.querySelectorAll('.m-rxn-btn').forEach(b=>{
    b.className='m-rxn-btn'+(rxn?b.dataset.e===rxn?' active':' inactive':'');
  });
}

function closeModal(e){
  if(e&&e.target!==document.getElementById('modal-overlay'))return;
  document.getElementById('modal-overlay').style.display='none';
  document.getElementById('modal-overlay').classList.remove('open');
  st.modalDay=null;
}

function reactModal(emoji){
  if(!st.modalDay)return;
  const cur=st.reactions[st.modalDay.id];
  const next=cur===emoji?null:emoji;
  st.reactions={...st.reactions,[st.modalDay.id]:next};
  S.set('tw_rxn',st.reactions);
  updateModalEmoji(next);
  renderCal();
}

function saveLog(){
  if(!st.modalDay)return;
  const th=parseInt(document.getElementById('m-th').value)||0;
  const tm=parseInt(document.getElementById('m-tm').value)||0;
  const ts2=parseInt(document.getElementById('m-ts').value)||0;
  const dist=parseFloat(document.getElementById('m-dist').value)||0;
  // Build display time string hh:mm:ss
  const timeStr=th>0?`${th}:${String(tm).padStart(2,'0')}:${String(ts2).padStart(2,'0')}`:
    `${tm}:${String(ts2).padStart(2,'0')}`;
  // Calculate pace
  let pace='';
  if(dist>0&&(th||tm||ts2)){
    const totalSec=th*3600+tm*60+ts2;
    const spk=totalSec/dist;
    pace=`${Math.floor(spk/60)}:${String(Math.round(spk%60)).padStart(2,'0')}/km`;
  }
  st.logs={...st.logs,[st.modalDay.id]:{th,tm,ts:ts2,distance:dist>0?dist:null,time:timeStr,pace}};
  S.set('tw_logs',st.logs);
  renderCal();
  document.getElementById('m-save').style.display='none';
  document.getElementById('m-saved').style.display='block';
  setTimeout(()=>closeModal({target:document.getElementById('modal-overlay')}),900);
}

// Swipe down to close modal
let mTouchY=0;
document.getElementById('modal').addEventListener('touchstart',e=>{mTouchY=e.touches[0].clientY;},{passive:true});
document.getElementById('modal').addEventListener('touchend',e=>{
  if(e.changedTouches[0].clientY-mTouchY>80)closeModal({target:document.getElementById('modal-overlay')});
},{passive:true});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ANALYTICS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderStats(){
  let totKm=0,totMins=0,totPlan=0;
  const kmData=[],timeData=[];
  st.weeks.forEach(w=>{
    let wkm=0,wm=0;
    w.days.forEach(d=>{
      const l=st.logs[d.id];
      if(l?.distance)wkm+=parseFloat(l.distance)||0;
      if(l?.th!==undefined){wm+=(l.th||0)*60+(l.tm||0)+(l.ts||0)/60;}
      else if(l?.time){const p=l.time.split(':').map(Number);wm+=(p[0]||0)*60+(p[1]||0);}
    });
    totKm+=wkm;totMins+=wm;totPlan+=w.totalKm;
    const lb=typeof w.num==='number'?`S${w.num}`:'üèÅ';
    kmData.push({lb,plan:w.totalKm,real:Math.round(wkm*10)/10});
    timeData.push({lb,m:Math.round(wm)});
  });
  const adh=totPlan?Math.round(totKm/totPlan*100):0;
  const semAct=st.weeks.filter(w=>w.days.some(d=>{const l=st.logs[d.id];return l?.distance||l?.time;})).length;
  const fmt=m=>m>=60?`${Math.floor(m/60)}h ${Math.round(m%60)}m`:`${Math.round(m)}m`;
  document.getElementById('stat-grid').innerHTML=`
    <div class="stat-card" style="border-color:#ffa47733"><div class="stat-val" style="color:#ffa477">${Math.round(totKm)}</div><div class="stat-lbl">km reales</div></div>
    <div class="stat-card" style="border-color:#b85c4e33"><div class="stat-val" style="color:#b85c4e;font-size:${totMins>0?'18px':'24px'}">${totMins>0?fmt(totMins):'‚Äì'}</div><div class="stat-lbl">tiempo total</div></div>
    <div class="stat-card" style="border-color:#ffbb7733"><div class="stat-val" style="color:#ffbb77">${adh}%</div><div class="stat-lbl">adherencia</div></div>
    <div class="stat-card" style="border-color:#ac6d7733"><div class="stat-val" style="color:#ac6d77">${semAct}</div><div class="stat-lbl">semanas activas</div></div>
  `;
  if(st.chartKm){st.chartKm.destroy();st.chartKm=null;}
  if(st.chartT){st.chartT.destroy();st.chartT=null;}
  const cOpts={responsive:true,maintainAspectRatio:true,plugins:{legend:{labels:{color:'#4a4a5a',font:{size:10}}}},scales:{x:{ticks:{color:'#3a3a4a',font:{size:9},maxRotation:0,autoSkip:true,maxTicksLimit:10},grid:{color:'#141420'}},y:{ticks:{color:'#3a3a4a',font:{size:9}},grid:{color:'#141420'}}}};
  st.chartKm=new Chart(document.getElementById('chart-km').getContext('2d'),{
    type:'line',
    data:{labels:kmData.map(d=>d.lb),datasets:[
      {label:'Plan',data:kmData.map(d=>d.plan),borderColor:'#2a2a35',borderDash:[4,2],borderWidth:1.5,pointRadius:0,tension:.3},
      {label:'Real',data:kmData.map(d=>d.real),borderColor:'#ffa477',backgroundColor:'#ffa47715',borderWidth:2.5,pointRadius:3,pointBackgroundColor:'#ffa477',fill:true,tension:.3},
    ]},options:{...cOpts}
  });
  st.chartT=new Chart(document.getElementById('chart-t').getContext('2d'),{
    type:'bar',
    data:{labels:timeData.map(d=>d.lb),datasets:[{label:'min',data:timeData.map(d=>d.m),backgroundColor:'#b85c4e44',borderColor:'#b85c4e',borderWidth:1,borderRadius:3}]},
    options:{...cOpts,plugins:{legend:{display:false}}}
  });
  const rc={};
  ['üòä','üòê','üòû'].forEach(e=>{rc[e]=0;});
  Object.values(st.reactions).forEach(r=>{if(r&&rc[r]!==undefined)rc[r]++;});
  const tot=Object.values(rc).reduce((s,c)=>s+c,0);
  const rsEl=document.getElementById('rxn-sum');
  if(tot===0){rsEl.innerHTML='<div style="color:#2a2a2a;font-size:12px">Registra entrenamientos para ver tus sensaciones.</div>';}
  else{rsEl.innerHTML=['üòä','üòê','üòû'].map(em=>`<div class="rxn-st"><div class="rxn-em">${em}</div><div class="rxn-ct">${rc[em]}</div><div class="rxn-pct">${Math.round(rc[em]/tot*100)}%</div></div>`).join('');}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABS & NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(tab){
  st.tab=tab;
  document.getElementById('tab-cal').classList.toggle('hidden',tab!=='cal');
  document.getElementById('tab-stats').classList.toggle('hidden',tab!=='stats');
  document.getElementById('tbtn-cal').classList.toggle('active',tab==='cal');
  document.getElementById('tbtn-stats').classList.toggle('active',tab==='stats');
  if(tab==='stats')renderStats();
}

document.getElementById('btn-prev').addEventListener('click',()=>{
  if(st.weekIdx>0){st.weekIdx--;st.selected=null;renderCal();}
});
document.getElementById('btn-next').addEventListener('click',()=>{
  if(st.weekIdx<st.weeks.length-1){st.weekIdx++;st.selected=null;renderCal();}
});

// Swipe to change week (on the week-nav area, not cards)
let sx=0,sy=0;
document.getElementById('week-nav').addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;},{passive:true});
document.getElementById('week-nav').addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-sx;
  const dy=Math.abs(e.changedTouches[0].clientY-sy);
  if(Math.abs(dx)>50&&dy<40){
    if(dx<0&&st.weekIdx<st.weeks.length-1){st.weekIdx++;st.selected=null;renderCal();}
    else if(dx>0&&st.weekIdx>0){st.weekIdx--;st.selected=null;renderCal();}
  }
},{passive:true});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PWA SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setupPWA(){
  const icon=`data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='80' fill='%23080808'/><text y='380' x='256' font-size='340' text-anchor='middle'>‚õ∞</text></svg>`;
  const mf={name:"Trail 44K ‚Äì Plan Entrenamiento",short_name:"Trail 44K",description:"Plan trail 44km 1500m D+",start_url:".",display:"standalone",background_color:"#080808",theme_color:"#080808",orientation:"portrait-primary",icons:[{src:icon,sizes:"192x192",type:"image/svg+xml"},{src:icon,sizes:"512x512",type:"image/svg+xml",purpose:"maskable"}]};
  try{
    const blob=new Blob([JSON.stringify(mf)],{type:'application/manifest+json'});
    document.getElementById('manifest-link').href=URL.createObjectURL(blob);
  }catch(e){}
  // Service worker
  if('serviceWorker' in navigator){
    const sw=`const C='trail44k-v1';
self.addEventListener('install',e=>{self.skipWaiting();});
self.addEventListener('activate',e=>{e.waitUntil(self.clients.claim());});
self.addEventListener('fetch',e=>{if(e.request.method!=='GET')return;e.respondWith(caches.open(C).then(c=>c.match(e.request).then(r=>r||fetch(e.request).then(res=>{c.put(e.request,res.clone());return res;}))));});`;
    try{
      const blob=new Blob([sw],{type:'text/javascript'});
      navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(()=>{});
    }catch(e){}
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EDITABLE TITLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initTitle(){
  const el=document.getElementById('app-title');
  const saved=localStorage.getItem('tw_title');
  if(saved)el.textContent=saved;
  el.addEventListener('blur',()=>{
    const v=el.textContent.trim()||'‚õ∞ Trail 44K';
    el.textContent=v;
    localStorage.setItem('tw_title',v);
  });
  el.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();el.blur();}});
}
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
setupPWA();
updateCountdown();
setInterval(updateCountdown, 60000);
initTitle();
renderCal();
</script>
</body>
</html>
